<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AI ë¶„ì„ ê²°ê³¼ - í‘ìƒ‰ì¢…</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #88c77d;
      font-family: 'Arial', sans-serif;
      text-align: center;
      color: #000;
    }
    .container {
      background-color: #fff;
      margin: 40px auto;
      padding: 30px;
      border-radius: 40px;
      width: 80%;
      max-width: 500px;
    }
    .lesion-image {
      width: 100%;
      max-width: 300px;
      border: 2px solid #888;
    }
    .result-title {
      font-weight: bold;
      margin-top: 20px;
    }
    .info-button {
      display: block;
      margin: 8px auto 0;
      font-size: 18px;
      background: none;
      border: none;
      cursor: pointer;
    }
    .metric-list {
      text-align: left;
      margin: 10px 0 20px 0;
      padding-left: 60px;
      line-height: 1.8;
    }
    .highlight {
      font-size: 20px;
      font-weight: bold;
      margin: 20px 0 10px;
    }
    .red-text {
      color: #d61919;
      font-weight: bold;
    }
    .button-area {
      margin-top: 30px;
    }
    .button-area button {
      padding: 10px 20px;
      margin: 10px;
      font-size: 16px;
      background-color: #4e914b;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .footer {
      font-size: 12px;
      margin-top: 30px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <img class="lesion-image" id="result-image" src="" alt="ë³‘ë³€ ë¶„ì„ ì´ë¯¸ì§€">

    <!-- ì œëª© + ë‹ë³´ê¸° ë²„íŠ¼ -->
    <div style="text-align: center;">
      <div class="result-title">[AI ë³‘ë³€ ë¶„ì„ ê²°ê³¼]</div>
      <button id="infoBtn" class="info-button">ğŸ”</button>
    </div>

    <div class="metric-list" id="feature-list"></div>
    <div class="highlight" id="final-class"></div>
    <div class="red-text" id="trust-risk"></div>

    <img src="{{ url_for('static', filename='images/mascot_shock.png') }}" alt="ë§ˆìŠ¤ì½”íŠ¸" width="120" style="margin-top: 20px;">

    <div class="button-area">
      <button onclick="window.location.href='/main'">ë‹¤ì‹œ ì´¬ì˜í•˜ê¸°</button>
      <button id="saveBtn">ê²°ê³¼ ì €ì¥í•˜ê¸°</button>
    </div>

    <div class="footer">
      ë³¸ ë¶„ì„ ê²°ê³¼ëŠ” ì°¸ê³ ìš©ì…ë‹ˆë‹¤.<br>
      ì •í™•í•œ ì§„ë‹¨ì„ ìœ„í•´ ì „ë¬¸ì˜ì˜ ìƒë‹´ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
    </div>
  </div>

  <!-- ğŸ” íŒì—… ë°•ìŠ¤ -->
  <div id="popup" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:999;">
    <div style="background:white; width:280px; margin:100px auto; padding:20px; border-radius:12px; position:relative;">
      <button onclick="document.getElementById('popup').style.display='none'" style="position:absolute; top:10px; right:15px; border:none; background:none; font-size:18px; cursor:pointer;">X</button>
      <div style="font-weight:bold; margin-bottom:10px;">[AI ë³‘ë³€ ë¶„ì„ ê²°ê³¼] <span style="color:red;">* ìˆ˜ì¹˜ *</span></div>
      <div style="text-align:left; font-size:14px; line-height:1.6;">
        - <b>ë¹„ëŒ€ì¹­ì„±</b>: ì™„ì „ ëŒ€ì¹­ì´ë©´ 0,<br>1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ë¹„ëŒ€ì¹­<br><br>
        - <b>ìƒ‰ìƒ ë‹¤ì–‘ì„±</b>: ìˆ˜ì¹˜ê°€ í´ìˆ˜ë¡ ë‹¤ì–‘í•œ ìƒ‰ìƒ ì¡´ì¬<br><br>
        - <b>ê²½ê³„ ë¶ˆê·œì¹™ì„±</b>: 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ì›í˜•,<br>1ë³´ë‹¤ í¬ë©´ ì°Œê·¸ëŸ¬ì§<br><br>
        - <b>í¬ê¸°</b>: ìµœì†Œ ì•…ì„± ê¸°ì¤€ì€ 6mm,<br>ëŒ€ë¶€ë¶„ ì •ìƒì€ ì´ë³´ë‹¤ ì‘ìŒ
      </div>
    </div>
  </div>

  <!-- ê²°ê³¼ ì¶œë ¥ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    const result = JSON.parse(sessionStorage.getItem("melanoma_result") || localStorage.getItem("melanoma_result"));

    if (result) {
      document.getElementById("result-image").src = "data:image/jpeg;base64," + result.boxed_image;

      document.getElementById("feature-list").innerHTML = `
        ãƒ» ë¹„ëŒ€ì¹­ì„±: ${parseFloat(result.features.asymmetry).toFixed(4)}<br>
        ãƒ» ìƒ‰ìƒ ë‹¤ì–‘ì„±: ${parseFloat(result.features.color).toFixed(4)}<br>
        ãƒ» ê²½ê³„ ë¶ˆê·œì¹™ì„±: ${parseFloat(result.features.border).toFixed(4)}<br>
        ãƒ» í¬ê¸°: ì•½ ${parseFloat(result.features.diameter).toFixed(4)} mm
      `;

      document.getElementById("final-class").innerHTML = `
        ${result.username} ë‹˜ì˜<br>AI í‘ìƒ‰ì¢… íŒë³„ ë¶„ì„ ê²°ê³¼<br>
        <strong>â€˜í‘ìƒ‰ì¢…â€™</strong>ìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.
      `;

      document.getElementById("trust-risk").innerHTML = `
        ì‹ ë¢°ë„: ${result.trust}%<br>
        ìœ„í—˜ë„: ${result.risk}
      `;
    } else {
      alert("ê²°ê³¼ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.");
      window.location.href = "/main";
    }

    // ğŸ” ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    document.getElementById("infoBtn").addEventListener("click", function () {
      document.getElementById("popup").style.display = "block";
    });
  </script>

  <!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

<script>
  document.getElementById("saveBtn").addEventListener("click", function () {
    const target = document.querySelector(".container");  // ìº¡ì²˜í•  ì˜ì—­ ì§€ì •

    html2canvas(target).then(canvas => {
      const link = document.createElement("a");
      link.href = canvas.toDataURL("image/png");
      link.download = "melanoma_result.png";  // íŒŒì¼ëª… ì›í•˜ëŠ” ëŒ€ë¡œ ë°”ê¿”ë„ ë¨
      link.click();
    });
  });
</script>


</body>
</html>
